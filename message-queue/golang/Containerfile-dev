# vi: ft=dockerfile
ARG registry=localhost
ARG tag=latest
FROM ${registry}/code-golf_message-queue_base-debian:${tag}

RUN \
  echo 'deb http://deb.debian.org/debian bookworm-backports main' \
  >/etc/apt/sources.list.d/backports.list

RUN apt-get update
RUN apt-get install -t bookworm-backports -y \
  golang

USER user
COPY --chown=user ../help.mk /home/
COPY --chown=user message-queue/mqp-base.mk /home/user/
COPY --chown=user \
  message-queue/golang/src/go.mod \
  message-queue/golang/src/go.sum \
  /home/user/mq/src/

WORKDIR mq
RUN cd src && go mod download -x
